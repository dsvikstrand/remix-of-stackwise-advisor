flowchart TD
  A["ID:A seed/seed_spec_v0.json (Seed Spec) TESTED_OK"] --> B["ID:B seed_stage0.ts (parse args + validate spec) TESTED_OK"]
  B --> C["ID:C Create run folder seed/outputs/RUN_ID/ TESTED_OK"]
  C --> G["ID:G Read SEED_USER_ACCESS_TOKEN TESTED_OK"]
  G --> H["ID:H n1 generate_library POST /api/generate-inventory TESTED_OK"]
  H --> H1["ID:H1 Write library.json TESTED_OK"]

  H1 --> I["ID:I n2 generate_blueprints POST /api/generate-blueprint TESTED_OK"]
  I --> I1["ID:I1 Write blueprints.json TESTED_OK"]

  I1 --> J["ID:J n3 build review_requests (no network) TESTED_OK"]
  J --> J1["ID:J1 Write review_requests.json TESTED_OK"]

  J1 --> K["ID:K n4 build banner_requests (no network) TESTED_OK"]
  K --> K1["ID:K1 Write banner_requests.json TESTED_OK"]

  K1 -.-> R["ID:R n3.5 execute_review POST /api/analyze-blueprint TESTED_OK"]
  R --> R1["ID:R1 Write reviews.json TESTED_OK"]

  R1 -.-> S["ID:S n4.5 execute_banner POST /api/generate-banner dryRun TESTED_OK"]
  S --> S1["ID:S1 Write banners.json TESTED_OK"]

  K1 --> L["ID:L n5 validate category+item references TESTED_OK"]
  S1 -.-> L
  L --> L1["ID:L1 Write validation.json TESTED_OK"]

  L1 --> M["ID:M n6 publish_payload (no writes) TESTED_OK"]
  M --> M1["ID:M1 Write publish_payload.json TESTED_OK"]

  M1 --> N["ID:N Append run_log.json timings+status TESTED_OK"]
  N --> Z

  Z["ID:Z Done (artifacts only) TESTED_OK"]

  %% Notes (hexagons) - point into nodes with key context
  NX1{{"NOTE: access token expires, refresh often"}} --> G
  NX2{{"NOTE: /api/analyze-blueprint is SSE, runner stitches text"}} --> R
  NX3{{"NOTE: /api/generate-banner dryRun returns base64, no Storage"}} --> S
  NX4{{"NOTE: image generation can be rate limited or safety rejected"}} --> S
  NX5{{"NOTE: seed/outputs is ignored, do not commit artifacts"}} --> C

  %% TODO nodes for the complete graph (Stage 1 apply mode, still simple)
  M1 -.-> T0["ID:T0 Stage 1 apply mode TODO"]
  T0 --> T1["ID:T1 Insert library/inventory into DB TODO"]
  T1 --> T2["ID:T2 Insert blueprint drafts into DB TODO"]
  T2 --> T3["ID:T3 Upload banner to Supabase Storage via upload-banner TODO"]
  T3 --> T4["ID:T4 Persist review text to blueprint row TODO"]
  T4 --> T5["ID:T5 Publish public blueprint (finalize) TODO"]
